%\documentclass[12pt, preprint]{aastex}
\documentclass[preprint,times,tighten]{aastex63}

\usepackage{epsf,color,amsmath}

\usepackage{cancel}

\newcommand{\sfrac}[2]{\mathchoice%
  {\kern0em\raise.5ex\hbox{\the\scriptfont0 #1}\kern-.15em/
    \kern-.15em\lower.25ex\hbox{\the\scriptfont0 #2}}
  {\kern0em\raise.5ex\hbox{\the\scriptfont0 #1}\kern-.15em/
    \kern-.15em\lower.25ex\hbox{\the\scriptfont0 #2}}
  {\kern0em\raise.5ex\hbox{\the\scriptscriptfont0 #1}\kern-.2em/
    \kern-.15em\lower.25ex\hbox{\the\scriptscriptfont0 #2}} {#1\!/#2}}

\newcommand{\myhalf}{\sfrac{1}{2}}
\newcommand{\nph}{{n+\myhalf}}
\newcommand{\nmh}{{n-\myhalf}}

\newcommand{\inp}{\mathrm{in}}
\newcommand{\outp}{\mathrm{out}}

% boldsymbol means bold italic
\newcommand{\eb}{{\bf{e}}}
\newcommand{\Ub}{{\bf{U}}}
\newcommand{\xb}{{\bf{x}}}
\newcommand{\kb}{{\bf{k}}}
\newcommand{\Vb}{{\bf{V}}_n}
\newcommand{\Vbhat}{{\bf{\widehat{V}}}_n}
\newcommand{\Omegab}{{\bf{\Omega}}}
\newcommand{\gb}{{\bf{g}}}
\newcommand{\rb}{{\bf{r}}}

\newcommand{\pb}{p_\mathrm{base}}
\newcommand{\epsdot}{\dot{\epsilon}}
\newcommand{\qburn}{q_\mathrm{burn}}
\newcommand{\rt}{\tilde{r}_0}


\newcommand{\nablab}{\mathbf{\nabla}}
\newcommand{\dt}{\Delta\ t}

\newcommand{\omegadot}{\dot{\omega}}
\newcommand{\enucdot}{\dot{e}_{nuc}}

\newcommand{\Hext}{H_{\rm ext}}
\newcommand{\Hnuc}{H_{\rm nuc}}
\newcommand{\kth}{k_{\rm th}}

\newcommand{\Gammaonebar}{\overline{\Gamma}_1}
\newcommand{\Sbar}{\overline{S}}

\newcommand{\etarho}{\eta_\rho}
\newcommand{\etarhoh}{\eta_{\rho~h}}

\newcommand{\Ubt}{\widetilde{\Ub}}
\newcommand{\wt}{\widetilde{w}}

\newcommand{\He}{$^4$He}
\newcommand{\C}{$^{12}$C}
\newcommand{\Fe}{$^{56}$Fe}

\newcommand{\isot}[2]{$^{#2}\mathrm{#1}$}
\newcommand{\isotm}[2]{{}^{#2}\mathrm{#1}}

\newcommand{\maestro}{{\sf MAESTRO}}
\newcommand{\castro}{{\sf Castro}}
\newcommand{\amrex}{{\sf AMReX}}
\newcommand{\pynucastro}{{\sf pynucastro}}

\newcommand{\avg}[1]{\overline{#1}}
\newcommand{\avgtwod}[1]{\langle~#1 \rangle}
\newcommand{\rms}[2]{\left(\delta#1\right)_{r_{#2}}}
\newcommand{\mymax}[1]{\left(#1\right)_{\rm max}}

\newcommand{\Tb}{\ensuremath{T_\mathrm{base}}}
\newcommand{\gcc}{\mathrm{g~cm^{-3} }}
\newcommand{\cms}{\mathrm{cm~s^{-1} }}

\newcommand{\half}{\frac{1}{2}}

% Approximately proportional to, from StackOverflow
\def\app#1#2{%
	\mathrel{%
		\setbox0=\hbox{$#1\sim$}%
		\setbox2=\hbox{%
			\rlap{\hbox{$#1\propto$}}%
			\lower1.1\ht0\box0%
		}%
		\raise0.25\ht2\box2%
	}%
}
\def\appropto{\mathpalette\app\relax}

\setlength{\marginparwidth}{0.5in}

\newcommand{\MarginPar}[1]{
    \marginpar{\vskip-\baselineskip%
               \raggedright%
               \tiny\sffamily%
               {\color{red}\hrule%
               \smallskip%
               #1\par%
               \smallskip%
               \hrule}}%
}

\newcommand{\AssignTo}[1]{
    \marginpar{\vskip-\baselineskip%
               \raggedright%
               \tiny\sffamily%
               {\color{blue}\hrule%
               \smallskip%
               #1\par%
               \smallskip%
               \hrule}}%
}

\begin{document}
%======================================================================
% Title
%======================================================================
\title{Dynamics of Laterally Propagating Flames in X-ray Bursts. II. Realistic Burning \& Rotation}

\shorttitle{Lateral Flame Dynamics II}
\shortauthors{Harpole et al.}

\author[0000-0002-1530-781X]{Alice Harpole}
\affiliation{Dept.\ of Physics and Astronomy, Stony Brook University,
             Stony Brook, NY 11794-3800}

\author[0000-0001-6191-4285]{Kiran Eiden}
\affiliation{Dept.\ of Physics and Astronomy, Stony Brook University,
             Stony Brook, NY 11794-3800}

\author[0000-0001-8401-030X]{Michael Zingale}
\affiliation{Dept.\ of Physics and Astronomy, Stony Brook University,
             Stony Brook, NY 11794-3800}
\affiliation{Center for Computational Astrophysics, Flatiron Institute, New York, NY 10010}

\author[0000-0001-8921-3624]{Nicole Ford}
\affiliation{Lawrence Berkeley National Laboratory, Berkeley, CA}

\author[0000-0003-2300-5165]{Donald Willcox}
\affiliation{Lawrence Berkeley National Laboratory, Berkeley, CA}

\author[0000-0002-6447-3603]{Yuri Cavecchi}
\affiliation{Mathematical Sciences and STAG Research Centre, University of Southampton, SO17 1BJ}

\author[0000-0003-0439-4556]{Max P.\ Katz}
\affiliation{NVIDIA Corp}


\correspondingauthor{Alice Harpole}
\email{alice.harpole@stonybrook.edu}


%======================================================================
% Abstract and Keywords
%======================================================================
\begin{abstract}
We continue to investigate laterally propagating flames in XRBs...


\end{abstract}

\keywords{X-ray bursts (1814), Nucleosynthesis (1131), Hydrodynamical simulations (767), Hydrodynamics (1963), Neutron stars (1108), Open source software (1866), Computational methods (1965)}

%======================================================================
% Introduction
%======================================================================
\section{Introduction}\label{Sec:Introduction}

Unlike our previous paper, all runs are now conducted without artificially boosting the speed of the flame in order to reduce the computational cost. This is possible because of the work done to offload the code to GPUs, where it runs significantly faster. We can therefore run the tests without any boosting. 


We investigate the effect of rotation rate on the flame. With the exception of (citation to the weird 11 Hz flame), most observations of XRBs come from sources with rotation rates of 200-600Hz \citep{bilous:2019,galloway:2020} \MarginPar{check whether this is true for XRBs or just burst oscillations}. There are a number of factors that could explain this lack of observations below 200 Hz. It could be that there is some physical process which inhibits the flame ignition and/or spread at lower rotation rates. It could be that burst oscillations at lower rotation rates are smaller in amplitude and therefore more difficult to detect. It could be that it's not got anything to do with the flame at all, but that neutron stars in accreting low mass X-ray binaries rarely have rotation rates below 200 Hz \MarginPar{look into this?}. 
 
Previous studies have found that rotation can have a significant affect on the flame's propagation. As the rotation rate increases, the Coriolis force whips the spreading flame up into a hurricane-like structure \citep{spitkovsky2002,cavecchi:2013}. The stronger Coriolis force leads to greater confinement of the hot accreted matter, leading to easier ignition of the flame \citep{art-2015-cavecchi-etal}. 

Previous work has predicted that crustal heating is stronger a lower accretion rates and weaker at higher accretion rates, due to the effect of neutrino losses \citep{Cumming2006,johnston:2019}. In our models, we keep the crust at a constant temperature, so by increasing this temperature we can effectively increase the crustal heating and mimic the effects of lower accretion rates. A shallow heating mechanism of as yet unknown origin has been found necessary to reproduce observed properties of XRBs \citep{Deibel2015,Turlione2015,Keek2017}.

In the following sections, we conduct a series of simulations at various rotation rates to investigate its effect on the flame. We find that at lower rotation rates, the flame itself becomes harder to ignite. We discuss the implications that this may have for burst physics and observations. 


%======================================================================
% Numerical Approach
%======================================================================
\section{Numerical Approach}\label{Sec:numerics}
\MarginPar{mz}

We use the Castro hydrodynamics code \citep{castro} and the simulation framework introduced in \citet{flame_wave1}.
The main difference is that we no longer boost the flames by adjusting
the reaction rates and conductivities.  By porting \castro\ to GPUs,
we are able to run the unboosted flame simulations with fewer
resources than the boosted simulations used in our earlier paper.

We add the geometric source terms from \citet{bernard-champmartin}

%======================================================================
% Results
%======================================================================
\section{Simulations and Results}\label{Sec:results}


Things to show:

\begin{figure}[t]
\centering
\plotone{time_series_500}
\caption{\label{fig:time_series_500} Time series of the 500 Hz run showing $\bar{A}$.}
\end{figure}

\begin{figure}[t]
\centering
\plotone{time_series_1000}
\caption{\label{fig:time_series_1000} Time series of the 1000 Hz run showing $\bar{A}$.}
\end{figure}


\begin{deluxetable}{lrrr}
	\tablecaption{\label{table:500Hz_runs} Temperature properties of the 500~Hz simulations.}
	\tablehead{\colhead{run} & \colhead{$\delta T$ (K)} & \colhead{$T_\mathrm{hi}$ (K)} & \colhead{$T_\mathrm{star}$ (K)}} 
	\startdata
	{\tt flame\_wave\_500}      & $1.2\times 10^9$ & $2\times 10^8$ & $10^8$ \\
	% Do we want the 100 Hz run in here as well, for completeness (and so we have a name to reference)?
	{\tt flame\_wave\_500\_2E8} & $1.2\times 10^9$ & $2\times 10^8$ & $2\times 10^8$ \\
	{\tt flame\_wave\_500\_3E8} & $1.1\times 10^9$ & $3\times 10^8$ & $3\times 10^8$ \\
	{\tt flame\_wave\_500\_4E8} & $10^9$ & $4\times 10^8$ & $4\times 10^8$ \\
	\enddata
	%
\end{deluxetable}

Figures~\ref{fig:time_series_500} and \ref{fig:time_series_1000} show
time series of the mean molecular weight for the 500~Hz and 1000~Hz
runs.  Compared to those in \cite{flame_wave1}, ashes behind the flame
do not reach as high atomic weights.  This is not surprising, since
those early runs boosted the reaction rates.  Comparing these two new
runs, we see that the burning is much more evolved for the higher
rotation rate.  We believe that this is because the rotation confines
the initial perturbation and subsequent expansion from the burning
better, allowing the reactions to progress further.

MZ: lateral profiles of X vs distance behind the flame; 
vertical profiles of the atmosphere behind the flame---how does it compare to isentropic?

what is the composition on the photosphere across the flame

different rotation rates. 250 Hz failed to ignite, could indicate that another source of confinement (e.g.\ magnetic fields) would need to take
over at lower rotation rates to allow a burst to occur, at least for our current initial model. We've seen that increasing rotation rate can
increase nuclear reaction rate already

shape of flame, amount of mixing (e.g. it looks like slower rotation rates have less mixed flames as the hurricane is less strong.)

Don: look at ratio of enuc to e?

\subsection{Flame Propagation}

For the purpose of measuring the flame propagation speed and acceleration, we track the position of each of our flames
as a function of time. We define the position in terms of a particular $\enucdot$ value, as we did in \citet{flame_wave1}.
To recapitulate: we first reduce the 2D $\enucdot$ data for each simulation run to a set of 1D radial profiles by averaging
over the vertical coordinate. After averaging, we take our reference $\enucdot$ value to be some fraction of the global $\enucdot$
maximum across all of these profiles. Since the flames in our simulations propagate rightward, we then search the region of
each profile to the right of the local $\enucdot$ maximum for the point where the $\enucdot$ first drops below this reference
value. This point gives us the location of our flame front.

In \citet{flame_wave1}, we used $0.1\%$ of the global $\enucdot$ maximum for our reference value. For the high temperature
unboosted flames, however, we found that the $\enucdot$ profiles failed to reach that small a value across the domain at most times,
which prevented us from getting reliable position measurements. We therefore use $1\%$ of the global $\enucdot$ maximum in this paper
rather than $0.1\%$. This is still sufficiently small that our measurements are not overly sensitive to turbulence and other local fluid
motions (the issue with simply tracking the local maximum), but allows us to avoid the pitfall encountered by the $0.1\%$ metric.

\begin{figure}[t]
	\centering
	\plotone{flame_speeds_rotation.pdf}
	\caption{\label{fig:flame_speeds_1} Flame front position vs.\ time for the standard ($10^8~\mathrm{K}$) 500 Hz and 1000 Hz runs. The dashed lines
		show quadratic least-squares fits to the data for $t \gtrsim 0.02~\mathrm{s}$.}
\end{figure}

\begin{figure}[t]
	\centering
	{\color{red} Placeholder for the flame speed plot that shows temperature dependence}
	\caption{\label{fig:flame_speeds_2} Flame front position vs.\ time for the three 500 Hz runs with
		$T_{\mathrm{star}} \leq 3 \times 10^8~\mathrm{K}$. The dashed lines show quadratic least-squares fits to the data
		for $t \gtrsim 0.02~\mathrm{s}$.}
\end{figure}

\begin{deluxetable}{lrrr}
	\tablecaption{\label{table:flame_speeds} Flame speed and acceleration values measured for each simulation. $s_0$ is the speed at $t = 0$.}
	\tablehead{\colhead{run} & \colhead{$s_0$ (cm s$^{-1}$)} & \colhead{$a$ (cm s$^{-2}$)}} 
	\startdata
	{\tt flame\_wave\_500}      & $(3.08 \pm 0.01) \times 10^5$ & $(5.41 \pm 0.19) \times 10^5$ \\
	{\tt flame\_wave\_1000}     & $(3.41 \pm 0.01) \times 10^5$ & $(-1.03 \pm 0.13) \times 10^5$ \\
	{\tt flame\_wave\_500\_2E8} & $(3.76 \pm 0.02) \times 10^5$ & $(1.74 \pm 0.17) \times 10^5$ \\
	{\tt flame\_wave\_500\_3E8} & $(5.29 \pm 0.10) \times 10^5$ & $(3.57 \pm 0.02) \times 10^7$ \\
	\enddata
	%
\end{deluxetable}

Figures~\ref{fig:flame_speeds_1} and \ref{fig:flame_speeds_2} give position vs.\ time for our runs, with the former showing dependence
on rotation rate and the latter on the neutron star temperature. As some of the runs (in particular the $\tt{flame\_wave\_3E8}$ run) exhibit
significant accelerations, we fit a quadratic curve to each set of data and calculate the acceleration and initial velocity from the fit
parameters. These results are given in Table~\ref{table:flame_speeds}.

We found in \citet{flame_wave1} that the flame speed $s$ obeys:
\begin{equation}
	s \appropto L_R (\epsdot)^{\half} \propto \frac{(\epsdot)^{\half}}{\Omega}
\end{equation}
where $\epsdot$ is the specific energy generation rate and $L_R$ is the Rossby length. This was consistent with the results of
\citet{cavecchi:2013}, who noted that the flame speeds in their simulations scaled with the Rossby length. As seen in
Figure~\ref{fig:flame_speeds_1}, there is no obvious inverse scaling with rotation rate in this set of runs. We observed earlier,
however, that nuclear reactions progress more quickly at the higher rotation rate. This results in a higher $\enucdot$ --- up to 4
to 6 times higher near the burning front after the flame ignites --- which may counteract the reduction in flame speed from the
increased Coriolis confinement. We also observe that 500 Hz run accelerates faster than the 1000 Hz run, which appears to experience a
small deceleration at early times. \MarginPar{This is speculation on my part -- does someone else have clear idea why?} This disparity
may be a direct result of the difference in Coriolis force. It could also be due to the 500 Hz flame taking more time to develop fully
and reach higher burning rates, resulting in an $\epsdot$ increase over time.

% It might be worth plotting peak enucdot as a function of time for each run

{\color{red} Maybe Nicole can talk a bit about the effect of the neutron star temperature here? I have a placeholder for the plot earlier, but
feel free to move/edit it. What's in this section now is just an initial draft/outline.}

Looking at the phase plots in Figures~\ref{fig:urho}-\ref{fig:abar}, we see:
\begin{itemize}
    \item From the $u$-$\rho$ and $u$-$v$ plots, we see that the burning occurs in a region of high density where the fluid is moving in a circular motion. From the previous plots (see: streamlines?), this most likely corresponds to the leading edge of the flame. This feature is not (yet?) developed in the 250~Hz flame. (will this ever develop, or will it just fizzle out completely?)
    \item From the $\bar{A}$-$T$ plots in Figure \ref{fig:abar}, we can see that as the rotation rate increases, so does the peak temperature. We believe that the tracks in the plot correspond to reaction pathways in the reaction network. In the 1000~Hz plot, these tracks are somewhat disrupted, possibly due to the more vigorous mixing of the vortex at the flame front. (If this continues or if the rotation was cranked even higher, would the reactions get so disrupted that the burning is snuffed out, similar to what happens in combustion when the turbulent vortices become so small they penetrate the reaction zone and completely disrupt it?)
\end{itemize}

\begin{figure}[t]
    \centering
    \plotone{urho_plot_0_1}
    \caption{\label{fig:urho}Phase plot of the horizontal $x$-velocity $u$, density $\rho$ and the nuclear energy generation rate $\dot{e}_{\rm nuc}$ for the 250, 500 and 1000~Hz runs.}
\end{figure}

\begin{figure}[t]
    \centering
    \plotone{uv_plot_0_1}
    \caption{\label{fig:uv}Phase plot of the horizontal $x$-velocity $u$, vertical $y$-velocity $v$ and the nuclear energy generation rate $\dot{e}_{\rm nuc}$ for the 250, 500 and 1000~Hz runs.}
\end{figure}

\begin{figure}[t]
    \centering
    \plotone{abar_plot_0_1}
    \caption{\label{fig:abar}Phase plot of the mean molecular weight $\bar{A}$, temperature $T$ and the nuclear energy generation rate $\dot{e}_{\rm nuc}$ for the 250, 500 and 1000~Hz runs.}
\end{figure}
    

\subsection{Effect of Temperature Structure}

\begin{figure}[t]
\centering
\plotone{compare_500Hz_abar}
\caption{\label{fig:compare_500Hz_abar} Comparison of $\bar{A}$ for 3 different 500~Hz models with different neutron star temperatures, $T_\star$, and resulting envelope
structures.  We see that the hottest model has a faster propagating flame.}
\end{figure}

Figure~\ref{fig:compare_500Hz_abar} shows 3 different 500 Hz simulations with different initial temperature structures.

\acknowledgements \castro\ is open-source and freely available at
\url{http://github.com/AMReX-Astro/Castro}.  The problem setups used
here are available in the git repo as {\tt flame} and {\tt
  flame\_wave}.  The work at Stony Brook was supported by DOE/Office
of Nuclear Physics grant DE-FG02-87ER40317.  This material is based upon work supported by the
U.S. Department of Energy, Office of Science, Office of Advanced
Scientific Computing Research and Office of Nuclear Physics, Scientific
Discovery through Advanced Computing (SciDAC) program under Award
Number DE-SC0017955.  This material is also based upon work supported by the U.S. Department
of Energy, Office of Science, Office of Advanced Scientific Computing Research, Department of
Energy Computational Science Graduate Fellowship under Award Number DE-SC0021110.
MZ acknowledges support from the Simons Foundation. 
This research used resources of the National Energy
Research Scientific Computing Center, a DOE Office of Science User
Facility supported by the Office of Science of the U.~S.\ Department
of Energy under Contract No.\ DE-AC02-05CH11231.  This research used
resources of the Oak Ridge Leadership Computing Facility at the Oak
Ridge National Laboratory, which is supported by the Office of Science
of the U.S. Department of Energy under Contract No. DE-AC05-00OR22725,
awarded through the DOE INCITE program.  We thank NVIDIA Corporation
for the donation of a Titan X and Titan V GPU through their academic
grant program.  This research has made use of NASA's Astrophysics Data
System Bibliographic Services.

\facilities{NERSC, OLCF}

\software{AMReX \citep{amrex_joss},
          Castro \citep{castro},
          GCC (\url{https://gcc.gnu.org/}),
          Jupyter \citep{Kluyver2016},
          linux (\url{https://www.kernel.org/}),
          matplotlib (\citealt{Hunter:2007}, \url{http://matplotlib.org/}),
          NumPy \citep{numpy,numpy2},
          python (\url{https://www.python.org/}),
          valgrind \citep{valgrind},
          VODE \citep{vode},
          yt \citep{yt}}



%======================================================================
% References
%======================================================================

\bibliographystyle{aasjournal}
\bibliography{ws}


\end{document}
